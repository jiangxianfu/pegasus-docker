FROM centos:7

MAINTAINER steven

RUN yum -y update && yum -y install epel-release && \
    yum -y install gcc-c++ bzip2 glibc automake autoconf libtool make python-devel \
                   git file wget unzip which \
                   glibc-devel openssl-devel boost-devel libaio-devel snappy-devel \
                   bzip2-devel zlib patch \
                   zlib-devel lz4-devel kernel-devel\
                   libzstd-devel jre nmap-ncat.x86_64 \
                   byacc flex bison

RUN cd /tmp && wget https://cmake.org/files/v3.18/cmake-3.18.4.tar.gz && \
    tar zxvf cmake-3.18.4.tar.gz && cd cmake-3.18.4 && \
    ./bootstrap && gmake && gmake install

RUN cd /tmp && wget http://ftp.gnu.org/gnu/gcc/gcc-7.5.0/gcc-7.5.0.tar.gz && \
    tar -zvxf gcc-7.5.0.tar.gz && cd gcc-7.5.0 && \
    ./contrib/download_prerequisites && \
    ./configure --enable-bootstrap --enable-shared --enable-threads=posix --enable-checking=release --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-gnu-unique-object --enable-linker-build-id --with-linker-hash-style=gnu --enable-languages=c,c++,go,lto --enable-plugin --enable-initfini-array --disable-libgcj --enable-gnu-indirect-function --with-tune=generic --disable-multilib && \
    make && make install

RUN git clone --recursive https://github.com/xiaomi/pegasus.git /pegasus

WORKDIR /pegasus